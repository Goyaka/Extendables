#targetengine "IIK"#include "lib/common.jsx"#include "lib/config.jsx"// event handler on savemain(); function main(){ app.documents[0].addEventListener("beforeSave", send_previews, false); }// wrapper function for the eventlistener callbackfunction send_previews() {	make_previews(true);	make_previews();	}function make_previews (isThumb) {	var thumb = "";// configurationvar myScriptSetup = [];myScriptSetup.push(["folder", [Folder.desktop.absoluteURI], "Select a folder to save layout previews in."]);myScriptSetup.push(["quality", ["High", "Low"], "Select the quality of the previews. Choose low if they'll be sent over the internet"]);var configuration = config($.fileName, myScriptSetup);/* SETTINGS */if (configuration.quality == "High") {	app.jpegExportPreferences.resolution = 96;	myDoc.exportForWebPreferences.jpegOptionsQuality = JPEGOptionsQuality.HIGH;} else { 	app.jpegExportPreferences.resolution = 48;		myDoc.exportForWebPreferences.jpegOptionsQuality = JPEGOptionsQuality.LOW; 	}app.jpegExportPreferences.exportingSpread = false;app.jpegExportPreferences.jpegExportRange = ExportRangeOrAllPages.EXPORT_RANGE;if (isThumb) { 	thumb = "-thumb";	app.jpegExportPreferences.resolution = 24; 	}myFolder = new Folder(configuration.folder);myFolder.create();// TODO: paginanummer van eerste spread teweten komen, want anders klopt de automatische nummering van InDesign niet.var countPages = myDoc.pages.count();try {var edition = myDoc.xmlItems[0].xmlItems[0].xmlAttributes.itemByName("edition").value;} catch (err) {	alert("To send layout previews to Drupal, you need to specify an edition in the XML.");	return false;	}// Removes all section prefixes - which otherwise would confuse the scriptmyDoc.sections.everyItem().sectionPrefix = "";myDoc.sections.everyItem().includeSectionPrefix = false;for (p = 0; p < countPages; p++) {var myPage = myDoc.pages.item(p);app.jpegExportPreferences.pageString = myPage.name;myDoc.exportFile("JPEG", new File(myFolder + "/" + edition + "-" + myPage.name + thumb + ".jpg"));}return true;} // f:send_previews